{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/chatController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/chatController.ts","mtime":1611744454241},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKaW1wb3J0IHsgaW8gfSBmcm9tICdzb2NrZXQnOwoKY29uc3Qgc2VuZCA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgbXNnLAogICAgdGFyZ2V0SWQKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBhd2FpdCBkYi5jaGF0cy5jcmVhdGUoewogICAgZnJvbTogY3R4LnN0YXRlLnVzZXIuX2lkLAogICAgdG86IHRhcmdldElkLAogICAgbXNnCiAgfSk7CiAgY29uc3QgdGFyZ2V0ID0gYXdhaXQgZGIuc2Vzc2lvbnMuZmluZE9uZSh7CiAgICB1c2VySWQ6IHRhcmdldElkCiAgfSk7CgogIGlmICh0YXJnZXQpIHsKICAgIGlvLnRvKHRhcmdldC5jb25uZWN0aW9uSWQpLmVtaXQoJ2NoYXQnLCBtc2cpOwogIH0gZWxzZSB7CiAgICBjb25zb2xlLmxvZygn7IOB64yA6rCAIOuhnOq3uOyYpO2UhOyDge2DnOudvOyEnCDrlJTruYTsl5Ag7KCA7J6l7ZW065y4Jyk7CiAgfQoKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIHNlbmQKfTs="},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/chatController.ts"],"names":["db","io","send","ctx","msg","targetId","request","body","chats","create","from","state","user","_id","to","target","sessions","findOne","userId","connectionId","emit","console","log","status"],"mappings":"AAAA,OAAOA,EAAP,MAAe,IAAf;AAEA,SAASC,EAAT,QAAmB,QAAnB;;AAEA,MAAMC,IAAgB,GAAG,MAAOC,GAAP,IAAe;AACtC,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAoBF,GAAG,CAACG,OAAJ,CAAYC,IAAtC;AACA,QAAMP,EAAE,CAACQ,KAAH,CAASC,MAAT,CAAgB;AAAEC,IAAAA,IAAI,EAAEP,GAAG,CAACQ,KAAJ,CAAUC,IAAV,CAAeC,GAAvB;AAA4BC,IAAAA,EAAE,EAAET,QAAhC;AAA0CD,IAAAA;AAA1C,GAAhB,CAAN;AACA,QAAMW,MAAM,GAAG,MAAMf,EAAE,CAACgB,QAAH,CAAYC,OAAZ,CAAoB;AAAEC,IAAAA,MAAM,EAAEb;AAAV,GAApB,CAArB;;AACA,MAAIU,MAAJ,EAAY;AACVd,IAAAA,EAAE,CAACa,EAAH,CAAMC,MAAM,CAACI,YAAb,EAA2BC,IAA3B,CAAgC,MAAhC,EAAwChB,GAAxC;AACD,GAFD,MAEO;AACLiB,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACD;;AACDnB,EAAAA,GAAG,CAACoB,MAAJ,GAAa,GAAb;AACD,CAVD;;AAYA,eAAe;AACbrB,EAAAA;AADa,CAAf","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\nimport { io } from 'socket';\n\nconst send: Controller = async (ctx) => {\n  const { msg, targetId } = ctx.request.body;\n  await db.chats.create({ from: ctx.state.user._id, to: targetId, msg });\n  const target = await db.sessions.findOne({ userId: targetId });\n  if (target) {\n    io.to(target.connectionId).emit('chat', msg);\n  } else {\n    console.log('상대가 로그오프상태라서 디비에 저장해뜸');\n  }\n  ctx.status = 200;\n};\n\nexport default {\n  send,\n};\n"]}]}