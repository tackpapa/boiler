{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts","mtime":1610970662479},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKaW1wb3J0IHVwbG9hZCBmcm9tICcuLi91dGlscy9zMyc7CmltcG9ydCBmcyBmcm9tICdmcyc7Cgpjb25zdCBjcmVhdGUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIHRpdGxlLAogICAgY29udGV4dCwKICAgIHRhZ3MKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBjb25zdCBhdXRob3IgPSBjdHguc3RhdGUudXNlci5faWQ7CiAgY29uc3QgbmV3dGFnID0gSlNPTi5wYXJzZSh0YWdzKTsKICBjb25zdCBpdGVtID0gYXdhaXQgZGIucG9zdHMuY3JlYXRlKHsKICAgIHRpdGxlLAogICAgY29udGV4dCwKICAgIGF1dGhvciwKICAgIHRhZ3M6IG5ld3RhZwogIH0pOwogIGNvbnN0IHsKICAgIHBhdGgKICB9ID0gY3R4LnJlcXVlc3QuZmlsZXMucGljOwogIGNvbnN0IGJvZHkgPSBmcy5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpOwogIGNvbnN0IHBhcmFtID0gewogICAgQnVja2V0OiBwcm9jZXNzLmVudi5wanRfbmFtZSwKICAgIEtleTogYGltYWdlLyR7aXRlbS5faWR9YCwKICAgIEFDTDogJ3B1YmxpYy1yZWFkJywKICAgIEJvZHk6IGJvZHksCiAgICBDb250ZW50VHlwZTogJ2ltYWdlL3BuZycKICB9OwogIGNvbnN0IHVwID0gYXdhaXQgdXBsb2FkKHBhcmFtKTsKICBpdGVtLnBpYyA9IHVwLkxvY2F0aW9uOwogIGl0ZW0uc2F2ZSgpOwogIGN0eC5zdGF0dXMgPSAyMDA7Cn07Cgpjb25zdCB1cGRhdGUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIGlkCiAgfSA9IGN0eC5wYXJhbXM7CiAgY29uc3QgewogICAgY29udGV4dCwKICAgIHRpdGxlLAogICAgdGFncwogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnN0IG5ld3RhZyA9IEpTT04ucGFyc2UodGFncyk7CiAgY29uc3QgYXV0aG9yID0gY3R4LnN0YXRlLnVzZXIuX2lkOwogIGNvbnN0IHBvc3QgPSBhd2FpdCBkYi5wb3N0cy5maW5kT25lQW5kVXBkYXRlKHsKICAgIF9pZDogaWQKICB9LCB7CiAgICBjb250ZXh0OiBjb250ZXh0LAogICAgdGFnczogbmV3dGFnLAogICAgdGl0bGU6IHRpdGxlCiAgfSk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKfTsKCmNvbnN0IGZpbmRvbmUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIGlkCiAgfSA9IGN0eC5wYXJhbXM7CiAgY29uc3QgcG9zdCA9IGF3YWl0IGRiLnBvc3RzLmZpbmRPbmUoewogICAgX2lkOiBpZAogIH0pOwogIGN0eC5zdGF0dXMgPSAyMDA7CiAgY3R4LmJvZHkgPSBwb3N0Owp9OwoKY29uc3QgbGF0ZXN0ID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCBwb3N0cyA9IGF3YWl0IGRiLnBvc3RzLmZpbmQoKS5zb3J0KHsKICAgIF9pZDogLTEKICB9KS5saW1pdCgxMCk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKICBjdHguYm9keSA9IHBvc3RzOwp9OwoKY29uc3QgZGVsZXRlb25lID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCB7CiAgICBpZAogIH0gPSBjdHgucGFyYW1zOwogIGNvbnN0IHBvc3QgPSBhd2FpdCBkYi5wb3N0cy5maW5kT25lQW5kUmVtb3ZlKHsKICAgIF9pZDogaWQKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZSwKICBkZWxldGVvbmUsCiAgdXBkYXRlLAogIGZpbmRvbmUsCiAgbGF0ZXN0Cn07"},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts"],"names":["db","upload","fs","create","ctx","title","context","tags","request","body","author","state","user","_id","newtag","JSON","parse","item","posts","path","files","pic","createReadStream","param","Bucket","process","env","pjt_name","Key","ACL","Body","ContentType","up","Location","save","status","update","id","params","post","findOneAndUpdate","findone","findOne","latest","find","sort","limit","deleteone","findOneAndRemove"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\nimport upload from '../utils/s3';\nimport fs from 'fs';\n\nconst create: Controller = async (ctx) => {\n  const { title, context, tags } = ctx.request.body;\n  const author = ctx.state.user._id;\n  const newtag = JSON.parse(tags);\n  const item = await db.posts.create({\n    title,\n    context,\n    author,\n    tags: newtag,\n  });\n  const { path } = ctx.request.files.pic;\n  const body = fs.createReadStream(path);\n  const param = {\n    Bucket: process.env.pjt_name,\n    Key: `image/${item._id}`,\n    ACL: 'public-read',\n    Body: body,\n    ContentType: 'image/png',\n  };\n  const up = await upload(param);\n  (item as any).pic = up.Location;\n  item.save();\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const { context, title, tags } = ctx.request.body;\n  const newtag = JSON.parse(tags);\n  const author = ctx.state.user._id;\n  const post = await db.posts.findOneAndUpdate(\n    { _id: id },\n    { context: context, tags: newtag, title: title }\n  );\n  ctx.status = 200;\n};\n\nconst findone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.posts.findOne({ _id: id });\n  ctx.status = 200;\n  ctx.body = post;\n};\n\nconst latest: Controller = async (ctx) => {\n  const posts = await db.posts.find().sort({ _id: -1 }).limit(10);\n  ctx.status = 200;\n  ctx.body = posts;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.posts.findOneAndRemove({ _id: id });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update, findone, latest };\n"]}]}