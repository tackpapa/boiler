{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/jobController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/jobController.ts","mtime":1611555781357},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKaW1wb3J0IHVwbG9hZCBmcm9tICcuLi91dGlscy9zMyc7CmltcG9ydCBmcyBmcm9tICdmcyc7Cgpjb25zdCBjcmVhdGUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIHRpdGxlLAogICAgY29udGV4dCwKICAgIHRhZ3MsCiAgICBsb2NhdGlvbgogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnN0IGF1dGhvciA9IGN0eC5zdGF0ZS51c2VyLl9pZDsKICBjb25zdCB1c2VyID0gYXdhaXQgZGIudXNlcnMuZmluZE9uZUFuZFVwZGF0ZSh7CiAgICBfaWQ6IGF1dGhvcgogIH0sIHsKICAgICRpbmM6IHsKICAgICAgZXhwOiArMTAKICAgIH0KICB9KTsKICB1c2VyPy5zYXZlKCk7CiAgY29uc3QgbmV3dGFnID0gSlNPTi5wYXJzZSh0YWdzKTsKICBjb25zdCBpdGVtID0gYXdhaXQgZGIuam9icy5jcmVhdGUoewogICAgdGl0bGUsCiAgICBjb250ZXh0LAogICAgYXV0aG9yLAogICAgdGFnczogbmV3dGFnLAogICAgbG9jYXRpb24KICB9KTsKICBbXS5jb25jYXQoY3R4LnJlcXVlc3QuZmlsZXMucGljKS5mb3JFYWNoKGFzeW5jICh7CiAgICBwYXRoCiAgfSwgaSkgPT4gewogICAgdmFyIHBhcmFtID0gewogICAgICBCdWNrZXQ6ICdyaWRhc3Byb2QnLAogICAgICBLZXk6IGBqb2JpbWFnZS8ke2l0ZW0uX2lkICsgaX1gLAogICAgICBBQ0w6ICdwdWJsaWMtcmVhZCcsCiAgICAgIEJvZHk6IGF3YWl0IGZzLmNyZWF0ZVJlYWRTdHJlYW0ocGF0aCksCiAgICAgIENvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJwogICAgfTsKICAgIGNvbnN0IGxhbGEgPSBhd2FpdCB1cGxvYWQocGFyYW0pOwogICAgYXdhaXQgaXRlbS5waWNzLnB1c2gobGFsYS5Mb2NhdGlvbik7CiAgICBpdGVtLnNhdmUoKTsKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgdXBkYXRlID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCB7CiAgICBpZAogIH0gPSBjdHgucGFyYW1zOwogIGNvbnN0IHsKICAgIGNvbnRleHQsCiAgICB0aXRsZSwKICAgIHRhZ3MsCiAgICBsb2NhdGlvbgogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnN0IG5ld3RhZyA9IEpTT04ucGFyc2UodGFncyk7CiAgY29uc3QgYXV0aG9yID0gY3R4LnN0YXRlLnVzZXIuX2lkOwogIGNvbnN0IHBvc3QgPSBhd2FpdCBkYi5qb2JzLmZpbmRPbmVBbmRVcGRhdGUoewogICAgX2lkOiBpZAogIH0sIHsKICAgIGNvbnRleHQ6IGNvbnRleHQsCiAgICB0YWdzOiBuZXd0YWcsCiAgICB0aXRsZTogdGl0bGUsCiAgICBsb2NhdGlvbjogbG9jYXRpb24KICB9KTsKICBwb3N0LnNhdmUoKTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgZmluZG9uZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgaWQKICB9ID0gY3R4LnBhcmFtczsKICBjb25zdCBwb3N0ID0gYXdhaXQgZGIuam9icy5maW5kT25lKHsKICAgIF9pZDogaWQKICB9KS5wb3B1bGF0ZSgnY29tbWVudHMnKTsKICBwb3N0Py52aWV3VXAoKTsKICBjdHguc3RhdHVzID0gMjAwOwogIGN0eC5ib2R5ID0gcG9zdDsKfTsKCmNvbnN0IGxhdGVzdCA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgcG9zdHMgPSBhd2FpdCBkYi5qb2JzLmZpbmQoKS5wb3B1bGF0ZSgnY29tbWVudHMnKS5zb3J0KHsKICAgIF9pZDogLTEKICB9KS5saW1pdCgyMCk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKICBjdHguYm9keSA9IHBvc3RzOwp9OwoKY29uc3Qgc2VhcmNoID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCB7CiAgICBxdWVyeQogIH0gPSBjdHgucGFyYW1zOwogIGNvbnN0IHBvc3QgPSBhd2FpdCBkYi5qb2JzLmZpbmQoewogICAgJHRleHQ6IHsKICAgICAgJHNlYXJjaDogcXVlcnkKICAgIH0KICB9KTsgLy8gY29uc3QgcG9zdDIgPSBhd2FpdCBkYi5wb3N0cy5maW5kKHsgdGl0bGU6IHsgJGluOiBxdWVyeSB9IH0pOwoKICBjdHguc3RhdHVzID0gMjAwOwogIGN0eC5ib2R5ID0gcG9zdDsKfTsKCmNvbnN0IGRlbGV0ZW9uZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgaWQKICB9ID0gY3R4LnBhcmFtczsKICBjb25zdCBwb3N0ID0gYXdhaXQgZGIuam9icy5maW5kT25lQW5kUmVtb3ZlKHsKICAgIF9pZDogaWQKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZSwKICBkZWxldGVvbmUsCiAgdXBkYXRlLAogIGZpbmRvbmUsCiAgc2VhcmNoLAogIGxhdGVzdAp9Ow=="},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/jobController.ts"],"names":["db","upload","fs","create","ctx","title","context","tags","location","request","body","author","state","user","_id","users","findOneAndUpdate","$inc","exp","save","newtag","JSON","parse","item","jobs","concat","files","pic","forEach","path","i","param","Bucket","Key","ACL","Body","createReadStream","ContentType","lala","pics","push","Location","status","update","id","params","post","findone","findOne","populate","viewUp","latest","posts","find","sort","limit","search","query","$text","$search","deleteone","findOneAndRemove"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\nimport upload from '../utils/s3';\nimport fs from 'fs';\n\nconst create: Controller = async (ctx) => {\n  const { title, context, tags, location } = ctx.request.body;\n  const author = ctx.state.user._id;\n  const user = await db.users.findOneAndUpdate(\n    { _id: author },\n    { $inc: { exp: +10 } }\n  );\n  user?.save();\n  const newtag = JSON.parse(tags);\n  const item = await db.jobs.create({\n    title,\n    context,\n    author,\n    tags: newtag,\n    location,\n  });\n\n  []\n    .concat(ctx.request.files.pic)\n    .forEach(async ({ path }: { path: string }, i: number) => {\n      var param = {\n        Bucket: 'ridasprod',\n        Key: `jobimage/${item._id + i}`,\n        ACL: 'public-read',\n        Body: await fs.createReadStream(path),\n        ContentType: 'image/png',\n      };\n      const lala = await upload(param);\n      await (item as any).pics.push(lala.Location);\n      item.save();\n    });\n\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const { context, title, tags, location } = ctx.request.body;\n  const newtag = JSON.parse(tags);\n  const author = ctx.state.user._id;\n  const post = await db.jobs.findOneAndUpdate(\n    { _id: id },\n    {\n      context: context,\n      tags: newtag,\n      title: title,\n      location: location,\n    }\n  );\n  (post as any).save();\n  ctx.status = 200;\n};\n\nconst findone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.jobs.findOne({ _id: id }).populate('comments');\n  post?.viewUp();\n  ctx.status = 200;\n  ctx.body = post;\n};\n\nconst latest: Controller = async (ctx) => {\n  const posts = await db.jobs\n    .find()\n    .populate('comments')\n    .sort({ _id: -1 })\n    .limit(20);\n  ctx.status = 200;\n  ctx.body = posts;\n};\n\nconst search: Controller = async (ctx) => {\n  const { query } = ctx.params;\n  const post = await db.jobs.find({ $text: { $search: query } });\n  // const post2 = await db.posts.find({ title: { $in: query } });\n  ctx.status = 200;\n  ctx.body = post;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.jobs.findOneAndRemove({ _id: id });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update, findone, search, latest };\n"]}]}