{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/marketController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/marketController.ts","mtime":1611316764083},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKaW1wb3J0IHVwbG9hZCBmcm9tICcuLi91dGlscy9zMyc7CmltcG9ydCBmcyBmcm9tICdmcyc7Cgpjb25zdCBjcmVhdGUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIHRpdGxlLAogICAgY29udGV4dCwKICAgIHRhZ3MsCiAgICBwcmljZQogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnNvbGUubG9nKGN0eC5yZXF1ZXN0LmJvZHkpOwogIGNvbnN0IGF1dGhvciA9IGN0eC5zdGF0ZS51c2VyLl9pZDsKICBjb25zdCBuZXd0YWcgPSBKU09OLnBhcnNlKHRhZ3MpOwogIGNvbnN0IGl0ZW0gPSBhd2FpdCBkYi5tYXJrZXRzLmNyZWF0ZSh7CiAgICB0aXRsZSwKICAgIGNvbnRleHQsCiAgICBhdXRob3IsCiAgICB0YWdzOiBuZXd0YWcsCiAgICBwcmljZQogIH0pOwogIHZhciBhcnIgPSBbXTsKICB2YXIgYXJyID0gW2N0eC5yZXF1ZXN0LmZpbGVzLnBpYy5wYXRoLCBjdHgucmVxdWVzdC5maWxlcy5waWMyLnBhdGhdOwoKICBmb3IgKHZhciB2YWwgb2YgYXJyKSB7CiAgICB2YXIgcGFyYW0gPSB7CiAgICAgIEJ1Y2tldDogJ3JpZGFzcHJvZCcsCiAgICAgIEtleTogYG1hcmtldGltYWdlLyR7aXRlbS5faWQgKyBNYXRoLnJhbmRvbSgpfWAsCiAgICAgIEFDTDogJ3B1YmxpYy1yZWFkJywKICAgICAgQm9keTogYXdhaXQgZnMuY3JlYXRlUmVhZFN0cmVhbSh2YWwpLAogICAgICBDb250ZW50VHlwZTogJ2ltYWdlL3BuZycKICAgIH07CiAgICBjb25zdCBsYWxhID0gYXdhaXQgdXBsb2FkKHBhcmFtKTsKICAgIGF3YWl0IGl0ZW0ucGljcy5wdXNoKGxhbGEuTG9jYXRpb24pOwogIH0KCiAgaXRlbS5zYXZlKCk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKfTsKCmNvbnN0IHVwZGF0ZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgaWQKICB9ID0gY3R4LnBhcmFtczsKICBjb25zdCB7CiAgICBjb250ZXh0LAogICAgdGl0bGUsCiAgICB0YWdzLAogICAgcHJpY2UKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBjb25zdCBuZXd0YWcgPSBKU09OLnBhcnNlKHRhZ3MpOwogIGNvbnN0IGF1dGhvciA9IGN0eC5zdGF0ZS51c2VyLl9pZDsKICBjb25zdCBwb3N0ID0gYXdhaXQgZGIubWFya2V0cy5maW5kT25lQW5kVXBkYXRlKHsKICAgIF9pZDogaWQKICB9LCB7CiAgICBjb250ZXh0OiBjb250ZXh0LAogICAgdGFnczogbmV3dGFnLAogICAgdGl0bGU6IHRpdGxlLAogICAgcHJpY2U6IHByaWNlCiAgfSk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKfTsKCmNvbnN0IGZpbmRvbmUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIGlkCiAgfSA9IGN0eC5wYXJhbXM7CiAgY29uc3QgcG9zdCA9IGF3YWl0IGRiLm1hcmtldHMuZmluZE9uZSh7CiAgICBfaWQ6IGlkCiAgfSk7CiAgcG9zdD8udmlld1VwKCk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKICBjdHguYm9keSA9IHBvc3Q7Cn07Cgpjb25zdCBsYXRlc3QgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHBvc3RzID0gYXdhaXQgZGIubWFya2V0cy5maW5kKCkuc29ydCh7CiAgICBfaWQ6IC0xCiAgfSkubGltaXQoMjApOwogIGN0eC5zdGF0dXMgPSAyMDA7CiAgY3R4LmJvZHkgPSBwb3N0czsKfTsKCmNvbnN0IGRlbGV0ZW9uZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgaWQKICB9ID0gY3R4LnBhcmFtczsKICBjb25zdCBwb3N0ID0gYXdhaXQgZGIubWFya2V0cy5maW5kT25lQW5kUmVtb3ZlKHsKICAgIF9pZDogaWQKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZSwKICBkZWxldGVvbmUsCiAgdXBkYXRlLAogIGZpbmRvbmUsCiAgbGF0ZXN0Cn07"},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/marketController.ts"],"names":["db","upload","fs","create","ctx","title","context","tags","price","request","body","console","log","author","state","user","_id","newtag","JSON","parse","item","markets","arr","files","pic","path","pic2","val","param","Bucket","Key","Math","random","ACL","Body","createReadStream","ContentType","lala","pics","push","Location","save","status","update","id","params","post","findOneAndUpdate","findone","findOne","viewUp","latest","posts","find","sort","limit","deleteone","findOneAndRemove"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\nimport upload from '../utils/s3';\nimport fs from 'fs';\n\nconst create: Controller = async (ctx) => {\n  const { title, context, tags, price } = ctx.request.body;\n  console.log(ctx.request.body);\n  const author = ctx.state.user._id;\n  const newtag = JSON.parse(tags);\n  const item = await db.markets.create({\n    title,\n    context,\n    author,\n    tags: newtag,\n    price,\n  });\n  var arr = [];\n\n  var arr = [ctx.request.files.pic.path, ctx.request.files.pic2.path];\n  for (var val of arr) {\n    var param = {\n      Bucket: 'ridasprod',\n      Key: `marketimage/${item._id + Math.random()}`,\n      ACL: 'public-read',\n      Body: await fs.createReadStream(val),\n      ContentType: 'image/png',\n    };\n    const lala = await upload(param);\n    await (item as any).pics.push(lala.Location);\n  }\n  item.save();\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const { context, title, tags, price } = ctx.request.body;\n  const newtag = JSON.parse(tags);\n  const author = ctx.state.user._id;\n  const post = await db.markets.findOneAndUpdate(\n    { _id: id },\n    { context: context, tags: newtag, title: title, price: price }\n  );\n  ctx.status = 200;\n};\n\nconst findone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.markets.findOne({ _id: id });\n  post?.viewUp();\n  ctx.status = 200;\n  ctx.body = post;\n};\n\nconst latest: Controller = async (ctx) => {\n  const posts = await db.markets.find().sort({ _id: -1 }).limit(20);\n  ctx.status = 200;\n  ctx.body = posts;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.markets.findOneAndRemove({ _id: id });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update, findone, latest };\n"]}]}