{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/socket.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/socket.ts","mtime":1611743139760},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHNvY2tldGlvIGZyb20gJ3NvY2tldC5pbyc7CmltcG9ydCBkYiBmcm9tICdkYic7CmV4cG9ydCBsZXQgaW87Cgpjb25zdCBpbml0ID0gc2VydmVyID0+IHsKICBpbyA9IHNvY2tldGlvKHNlcnZlcik7CiAgaW8ub24oJ2Nvbm5lY3Rpb24nLCBzb2NrZXQgPT4gewogICAgc29ja2V0Lm9uKCdjcmVhdGVTZXNzaW9uJywgYXN5bmMgdXNlcklkID0+IHsKICAgICAgYXdhaXQgZGIuc2Vzc2lvbnMuZGVsZXRlTWFueSh7CiAgICAgICAgdXNlcklkCiAgICAgIH0pOwogICAgICBhd2FpdCBkYi5zZXNzaW9ucy5jcmVhdGUoewogICAgICAgIHVzZXJJZCwKICAgICAgICBjb25uZWN0aW9uSWQ6IHNvY2tldC5pZAogICAgICB9KTsKICAgIH0pOwogICAgc29ja2V0Lm9uKCdicmluZ2NoYXRzJywgYXN5bmMgdXNlcklkID0+IHsKICAgICAgY29uc3Qgc2F2ZWRjaGF0cyA9IGF3YWl0IGRiLmNoYXRzLmZpbmQoewogICAgICAgIHRvOiB1c2VySWQKICAgICAgfSkuc29ydCh7CiAgICAgICAgX2lkOiAxCiAgICAgIH0pOwogICAgICBzYXZlZGNoYXRzLmZvckVhY2goaSA9PiB7CiAgICAgICAgaW8uZW1pdCh1c2VySWQuY29ubmVjdGlvbklkKS5lbWl0KCdjaGF0JywgaS5tc2cpOwogICAgICB9KTsKICAgIH0pOwogICAgc29ja2V0Lm9uKCdkaXNjb25uZWN0JywgYXN5bmMgKCkgPT4gewogICAgICBhd2FpdCBkYi5zZXNzaW9ucy5kZWxldGVNYW55KHsKICAgICAgICBjb25uZWN0aW9uSWQ6IHNvY2tldC5pZAogICAgICB9KTsKICAgIH0pOwogIH0pOwp9OwoKZXhwb3J0IGRlZmF1bHQgaW5pdDs="},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/socket.ts"],"names":["socketio","db","io","init","server","on","socket","userId","sessions","deleteMany","create","connectionId","id","savedchats","chats","find","to","sort","_id","forEach","i","emit","msg"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,WAArB;AAEA,OAAOC,EAAP,MAAe,IAAf;AACA,OAAO,IAAIC,EAAJ;;AAEP,MAAMC,IAAI,GAAIC,MAAD,IAAoB;AAC/BF,EAAAA,EAAE,GAAGF,QAAQ,CAACI,MAAD,CAAb;AAEAF,EAAAA,EAAE,CAACG,EAAH,CAAM,YAAN,EAAqBC,MAAD,IAAY;AAC9BA,IAAAA,MAAM,CAACD,EAAP,CAAU,eAAV,EAA2B,MAAOE,MAAP,IAAkB;AAC3C,YAAMN,EAAE,CAACO,QAAH,CAAYC,UAAZ,CAAuB;AAAEF,QAAAA;AAAF,OAAvB,CAAN;AACA,YAAMN,EAAE,CAACO,QAAH,CAAYE,MAAZ,CAAmB;AAAEH,QAAAA,MAAF;AAAUI,QAAAA,YAAY,EAAEL,MAAM,CAACM;AAA/B,OAAnB,CAAN;AACD,KAHD;AAIAN,IAAAA,MAAM,CAACD,EAAP,CAAU,YAAV,EAAwB,MAAOE,MAAP,IAAkB;AACxC,YAAMM,UAAU,GAAG,MAAMZ,EAAE,CAACa,KAAH,CAASC,IAAT,CAAc;AAAEC,QAAAA,EAAE,EAAET;AAAN,OAAd,EAA8BU,IAA9B,CAAmC;AAAEC,QAAAA,GAAG,EAAE;AAAP,OAAnC,CAAzB;AACAL,MAAAA,UAAU,CAACM,OAAX,CAAoBC,CAAD,IAAO;AACxBlB,QAAAA,EAAE,CAACmB,IAAH,CAAQd,MAAM,CAACI,YAAf,EAA6BU,IAA7B,CAAkC,MAAlC,EAA0CD,CAAC,CAACE,GAA5C;AACD,OAFD;AAGD,KALD;AAMAhB,IAAAA,MAAM,CAACD,EAAP,CAAU,YAAV,EAAwB,YAAY;AAClC,YAAMJ,EAAE,CAACO,QAAH,CAAYC,UAAZ,CAAuB;AAAEE,QAAAA,YAAY,EAAEL,MAAM,CAACM;AAAvB,OAAvB,CAAN;AACD,KAFD;AAGD,GAdD;AAeD,CAlBD;;AAoBA,eAAeT,IAAf","sourcesContent":["import socketio from 'socket.io';\nimport { Server } from 'http';\nimport db from 'db';\nexport let io: ReturnType<typeof socketio>;\n\nconst init = (server: Server) => {\n  io = socketio(server);\n\n  io.on('connection', (socket) => {\n    socket.on('createSession', async (userId) => {\n      await db.sessions.deleteMany({ userId });\n      await db.sessions.create({ userId, connectionId: socket.id });\n    });\n    socket.on('bringchats', async (userId) => {\n      const savedchats = await db.chats.find({ to: userId }).sort({ _id: 1 });\n      savedchats.forEach((i) => {\n        io.emit(userId.connectionId).emit('chat', i.msg);\n      });\n    });\n    socket.on('disconnect', async () => {\n      await db.sessions.deleteMany({ connectionId: socket.id });\n    });\n  });\n};\n\nexport default init;\n"]}]}