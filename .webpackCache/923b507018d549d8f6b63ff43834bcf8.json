{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts","mtime":1611317489539},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKaW1wb3J0IHVwbG9hZCBmcm9tICcuLi91dGlscy9zMyc7CmltcG9ydCBmcyBmcm9tICdmcyc7Cgpjb25zdCBjcmVhdGUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIHRpdGxlLAogICAgY29udGV4dCwKICAgIHRhZ3MsCiAgICBsb2NhdGlvbgogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnN0IGF1dGhvciA9IGN0eC5zdGF0ZS51c2VyLl9pZDsKICBjb25zdCBuZXd0YWcgPSBKU09OLnBhcnNlKHRhZ3MpOwogIGNvbnN0IGl0ZW0gPSBhd2FpdCBkYi5wb3N0cy5jcmVhdGUoewogICAgdGl0bGUsCiAgICBjb250ZXh0LAogICAgYXV0aG9yLAogICAgdGFnczogbmV3dGFnLAogICAgbG9jYXRpb24KICB9KTsKICBjdHgucmVxdWVzdC5maWxlcy5waWMuZm9yRWFjaChhc3luYyAoewogICAgcGF0aAogIH0sIGkpID0+IHsKICAgIHZhciBwYXJhbSA9IHsKICAgICAgQnVja2V0OiAncmlkYXNwcm9kJywKICAgICAgS2V5OiBgcG9zdGltYWdlLyR7aXRlbS5faWQgKyBpfWAsCiAgICAgIEFDTDogJ3B1YmxpYy1yZWFkJywKICAgICAgQm9keTogYXdhaXQgZnMuY3JlYXRlUmVhZFN0cmVhbShwYXRoKSwKICAgICAgQ29udGVudFR5cGU6ICdpbWFnZS9wbmcnCiAgICB9OwogICAgY29uc3QgbGFsYSA9IGF3YWl0IHVwbG9hZChwYXJhbSk7CiAgICBhd2FpdCBpdGVtLnBpY3MucHVzaChsYWxhLkxvY2F0aW9uKTsKICB9KTsKICBpdGVtLnNhdmUoKTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgdXBkYXRlID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCB7CiAgICBpZAogIH0gPSBjdHgucGFyYW1zOwogIGNvbnN0IHsKICAgIGNvbnRleHQsCiAgICB0aXRsZSwKICAgIHRhZ3MsCiAgICBpc2pvYiwKICAgIGxvY2F0aW9uCiAgfSA9IGN0eC5yZXF1ZXN0LmJvZHk7CiAgY29uc3QgbmV3dGFnID0gSlNPTi5wYXJzZSh0YWdzKTsKICBjb25zdCBhdXRob3IgPSBjdHguc3RhdGUudXNlci5faWQ7CiAgY29uc3QgcG9zdCA9IGF3YWl0IGRiLnBvc3RzLmZpbmRPbmVBbmRVcGRhdGUoewogICAgX2lkOiBpZAogIH0sIHsKICAgIGNvbnRleHQ6IGNvbnRleHQsCiAgICB0YWdzOiBuZXd0YWcsCiAgICB0aXRsZTogdGl0bGUsCiAgICBsb2NhdGlvbjogbG9jYXRpb24KICB9KTsKICBwb3N0LnNhdmUoKTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgZmluZG9uZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgaWQKICB9ID0gY3R4LnBhcmFtczsKICBjb25zdCBwb3N0ID0gYXdhaXQgZGIucG9zdHMuZmluZE9uZSh7CiAgICBfaWQ6IGlkCiAgfSk7CiAgcG9zdD8udmlld1VwKCk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKICBjdHguYm9keSA9IHBvc3Q7Cn07Cgpjb25zdCBsYXRlc3QgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHBvc3RzID0gYXdhaXQgZGIucG9zdHMuZmluZCgpLnNvcnQoewogICAgX2lkOiAtMQogIH0pLmxpbWl0KDIwKTsKICBjdHguc3RhdHVzID0gMjAwOwogIGN0eC5ib2R5ID0gcG9zdHM7Cn07Cgpjb25zdCBkZWxldGVvbmUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IHsKICAgIGlkCiAgfSA9IGN0eC5wYXJhbXM7CiAgY29uc3QgcG9zdCA9IGF3YWl0IGRiLnBvc3RzLmZpbmRPbmVBbmRSZW1vdmUoewogICAgX2lkOiBpZAogIH0pOwogIGN0eC5zdGF0dXMgPSAyMDA7Cn07CgpleHBvcnQgZGVmYXVsdCB7CiAgY3JlYXRlLAogIGRlbGV0ZW9uZSwKICB1cGRhdGUsCiAgZmluZG9uZSwKICBsYXRlc3QKfTs="},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/postController.ts"],"names":["db","upload","fs","create","ctx","title","context","tags","location","request","body","author","state","user","_id","newtag","JSON","parse","item","posts","files","pic","forEach","path","i","param","Bucket","Key","ACL","Body","createReadStream","ContentType","lala","pics","push","Location","save","status","update","id","params","isjob","post","findOneAndUpdate","findone","findOne","viewUp","latest","find","sort","limit","deleteone","findOneAndRemove"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\nimport upload from '../utils/s3';\nimport fs from 'fs';\n\nconst create: Controller = async (ctx) => {\n  const { title, context, tags, location } = ctx.request.body;\n  const author = ctx.state.user._id;\n  const newtag = JSON.parse(tags);\n  const item = await db.posts.create({\n    title,\n    context,\n    author,\n    tags: newtag,\n    location,\n  });\n\n  ctx.request.files.pic.forEach(\n    async ({ path }: { path: string }, i: number) => {\n      var param = {\n        Bucket: 'ridasprod',\n        Key: `postimage/${item._id + i}`,\n        ACL: 'public-read',\n        Body: await fs.createReadStream(path),\n        ContentType: 'image/png',\n      };\n      const lala = await upload(param);\n      await (item as any).pics.push(lala.Location);\n    }\n  );\n\n  item.save();\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const { context, title, tags, isjob, location } = ctx.request.body;\n  const newtag = JSON.parse(tags);\n  const author = ctx.state.user._id;\n  const post = await db.posts.findOneAndUpdate(\n    { _id: id },\n    {\n      context: context,\n      tags: newtag,\n      title: title,\n      location: location,\n    }\n  );\n  (post as any).save();\n  ctx.status = 200;\n};\n\nconst findone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.posts.findOne({ _id: id });\n  post?.viewUp();\n  ctx.status = 200;\n  ctx.body = post;\n};\n\nconst latest: Controller = async (ctx) => {\n  const posts = await db.posts.find().sort({ _id: -1 }).limit(20);\n  ctx.status = 200;\n  ctx.body = posts;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const { id } = ctx.params;\n  const post = await db.posts.findOneAndRemove({ _id: id });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update, findone, latest };\n"]}]}