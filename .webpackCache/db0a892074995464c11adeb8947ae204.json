{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts","mtime":1611672084799},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKCmNvbnN0IGNyZWF0ZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgdGV4dCwKICAgIHBvc3QsCiAgICBwb3N0bW9kZWwKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBjb25zdCBhdXRob3IgPSBhd2FpdCBkYi51c2Vycy5maW5kT25lKHsKICAgIF9pZDogY3R4LnN0YXRlLnVzZXIuX2lkCiAgfSk7CiAgY29uc3QgZXhwdXAgPSBhd2FpdCBkYi51c2Vycy5maW5kT25lQW5kVXBkYXRlKHsKICAgIF9pZDogYXV0aG9yLl9pZAogIH0sIHsKICAgICRpbmM6IHsKICAgICAgZXhwOiArMQogICAgfQogIH0pOwogIGV4cHVwPy5zYXZlKCk7CiAgY29uc3QgY29tbWVudCA9IGF3YWl0IGRiLmNvbW1lbnRzLmNyZWF0ZSh7CiAgICB0ZXh0LAogICAgYXV0aG9yOiBhdXRob3IubmFtZSwKICAgIGF1dGhvcmV4cDogYXV0aG9yLmV4cCwKICAgIHBvc3QsCiAgICBwb3N0bW9kZWwKICB9KTsKCiAgdHJ5IHsKICAgIGNvbnN0IGNtdHB1c2ggPSBhd2FpdCBkYi5wb3N0cy5maW5kT25lKHsKICAgICAgX2lkOiBwb3N0CiAgICB9KTsKICAgIGF3YWl0IGNtdHB1c2guY29tbWVudHMucHVzaChjb21tZW50Ll9pZCk7CiAgICBjbXRwdXNoPy5zYXZlKCk7CiAgfSBjYXRjaCAoZXJyKSB7fQoKICB0cnkgewogICAgY29uc3QgY210cHVzaCA9IGF3YWl0IGRiLmpvYnMuZmluZE9uZSh7CiAgICAgIF9pZDogcG9zdAogICAgfSk7CiAgICBhd2FpdCBjbXRwdXNoLmNvbW1lbnRzLnB1c2goY29tbWVudC5faWQpOwogICAgY210cHVzaD8uc2F2ZSgpOwogIH0gY2F0Y2ggKGVycikge30KCiAgdHJ5IHsKICAgIGNvbnN0IGNtdHB1c2ggPSBhd2FpdCBkYi5tYXJrZXRzLmZpbmRPbmUoewogICAgICBfaWQ6IHBvc3QKICAgIH0pOwogICAgYXdhaXQgY210cHVzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQuX2lkKTsKICAgIGNtdHB1c2g/LnNhdmUoKTsKICB9IGNhdGNoIChlcnIpIHt9CgogIHRyeSB7CiAgICBjb25zdCBjbXRwdXNoID0gYXdhaXQgZGIuY29tbWVudHMuZmluZE9uZSh7CiAgICAgIF9pZDogcG9zdAogICAgfSk7CiAgICBhd2FpdCBjbXRwdXNoLnJlY29tbWVudHMucHVzaChjb21tZW50Ll9pZCk7CiAgICBjbXRwdXNoPy5zYXZlKCk7CiAgfSBjYXRjaCAoZXJyKSB7fQoKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgdXBkYXRlID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCBpZCA9IGN0eC5wYXJhbXMuaWQ7CiAgY29uc3QgewogICAgdGV4dAogIH0gPSBjdHgucmVxdWVzdC5ib2R5OwogIGNvbnN0IHVwID0gYXdhaXQgZGIuY29tbWVudHMuZmluZE9uZUFuZFVwZGF0ZSh7CiAgICBfaWQ6IGlkCiAgfSwgewogICAgdGV4dAogIH0pOwogIGN0eC5zdGF0dXMgPSAyMDA7Cn07Cgpjb25zdCBkZWxldGVvbmUgPSBhc3luYyBjdHggPT4gewogIGNvbnN0IGlkID0gY3R4LnBhcmFtcy5pZDsKICBjb25zdCBkZWwgPSBhd2FpdCBkYi5jb21tZW50cy5maW5kT25lQW5kRGVsZXRlKHsKICAgIF9pZDogaWQKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZSwKICBkZWxldGVvbmUsCiAgdXBkYXRlCn07"},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts"],"names":["db","create","ctx","text","post","postmodel","request","body","author","users","findOne","_id","state","user","expup","findOneAndUpdate","$inc","exp","save","comment","comments","name","authorexp","cmtpush","posts","push","err","jobs","markets","recomments","status","update","id","params","up","deleteone","del","findOneAndDelete"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { findConfigFile } from 'typescript';\nimport { Controller } from './types';\n\nconst create: Controller = async (ctx) => {\n  const { text, post, postmodel } = ctx.request.body;\n  const author: any = await db.users.findOne({ _id: ctx.state.user._id });\n  const expup = await db.users.findOneAndUpdate(\n    { _id: author._id },\n    { $inc: { exp: +1 } }\n  );\n  expup?.save();\n  const comment = await db.comments.create({\n    text,\n    author: author.name,\n    authorexp: author.exp,\n    post,\n    postmodel,\n  });\n  try {\n    const cmtpush = await db.posts.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.jobs.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.markets.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.comments.findOne({ _id: post });\n    await (cmtpush as any).recomments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const id = ctx.params.id;\n  const { text } = ctx.request.body;\n  const up = await db.comments.findOneAndUpdate(\n    { _id: id },\n    {\n      text,\n    }\n  );\n  ctx.status = 200;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const id = ctx.params.id;\n  const del = await db.comments.findOneAndDelete({\n    _id: id,\n  });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update };\n"]}]}