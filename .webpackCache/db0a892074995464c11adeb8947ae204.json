{"remainingRequest":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[0].use[1]!/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts","dependencies":[{"path":"/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts","mtime":1611853993943},{"path":"/Users/kiyoungtack/Desktop/boiler/.babelrc","mtime":1610697389559},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kiyoungtack/Desktop/boiler/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGRiIGZyb20gJ2RiJzsKCmNvbnN0IGNyZWF0ZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgewogICAgdGV4dCwKICAgIHBvc3QsCiAgICBwb3N0bW9kZWwsCiAgICB0YXJnZXQKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBjb25zdCBhdXRob3IgPSBhd2FpdCBkYi51c2Vycy5maW5kT25lKHsKICAgIF9pZDogY3R4LnN0YXRlLnVzZXIuX2lkCiAgfSk7CiAgY29uc3QgZXhwdXAgPSBhd2FpdCBkYi51c2Vycy5maW5kT25lQW5kVXBkYXRlKHsKICAgIF9pZDogYXV0aG9yLl9pZAogIH0sIHsKICAgICRpbmM6IHsKICAgICAgZXhwOiArMQogICAgfQogIH0pOwogIGV4cHVwPy5zYXZlKCk7CiAgY29uc3QgY29tbWVudCA9IGF3YWl0IGRiLmNvbW1lbnRzLmNyZWF0ZSh7CiAgICB0ZXh0LAogICAgYXV0aG9yOiBhdXRob3IsCiAgICBwb3N0LAogICAgcG9zdG1vZGVsLAogICAgdGFyZ2V0CiAgfSk7CgogIHRyeSB7CiAgICBjb25zdCBjbXRwdXNoID0gYXdhaXQgZGIucG9zdHMuZmluZE9uZSh7CiAgICAgIF9pZDogcG9zdAogICAgfSk7CiAgICBhd2FpdCBjbXRwdXNoLmNvbW1lbnRzLnB1c2goY29tbWVudC5faWQpOwogICAgY210cHVzaD8uc2F2ZSgpOwogIH0gY2F0Y2ggKGVycikge30KCiAgdHJ5IHsKICAgIGNvbnN0IGNtdHB1c2ggPSBhd2FpdCBkYi5qb2JzLmZpbmRPbmUoewogICAgICBfaWQ6IHBvc3QKICAgIH0pOwogICAgYXdhaXQgY210cHVzaC5jb21tZW50cy5wdXNoKGNvbW1lbnQuX2lkKTsKICAgIGNtdHB1c2g/LnNhdmUoKTsKICB9IGNhdGNoIChlcnIpIHt9CgogIHRyeSB7CiAgICBjb25zdCBjbXRwdXNoID0gYXdhaXQgZGIubWFya2V0cy5maW5kT25lKHsKICAgICAgX2lkOiBwb3N0CiAgICB9KTsKICAgIGF3YWl0IGNtdHB1c2guY29tbWVudHMucHVzaChjb21tZW50Ll9pZCk7CiAgICBjbXRwdXNoPy5zYXZlKCk7CiAgfSBjYXRjaCAoZXJyKSB7fQoKICB0cnkgewogICAgY29uc3QgY210cHVzaCA9IGF3YWl0IGRiLmNvbW1lbnRzLmZpbmRPbmUoewogICAgICBfaWQ6IHBvc3QKICAgIH0pOwogICAgYXdhaXQgY210cHVzaC5yZWNvbW1lbnRzLnB1c2goY29tbWVudC5faWQpOwogICAgY210cHVzaD8uc2F2ZSgpOwogIH0gY2F0Y2ggKGVycikge30KCiAgY3R4LnN0YXR1cyA9IDIwMDsKfTsKCmNvbnN0IHVwZGF0ZSA9IGFzeW5jIGN0eCA9PiB7CiAgY29uc3QgaWQgPSBjdHgucGFyYW1zLmlkOwogIGNvbnN0IHsKICAgIHRleHQKICB9ID0gY3R4LnJlcXVlc3QuYm9keTsKICBjb25zdCB1cCA9IGF3YWl0IGRiLmNvbW1lbnRzLmZpbmRPbmVBbmRVcGRhdGUoewogICAgX2lkOiBpZAogIH0sIHsKICAgIHRleHQKICB9KTsKICBjdHguc3RhdHVzID0gMjAwOwp9OwoKY29uc3QgZGVsZXRlb25lID0gYXN5bmMgY3R4ID0+IHsKICBjb25zdCBpZCA9IGN0eC5wYXJhbXMuaWQ7CiAgY29uc3QgZGVsID0gYXdhaXQgZGIuY29tbWVudHMuZmluZE9uZUFuZERlbGV0ZSh7CiAgICBfaWQ6IGlkCiAgfSk7CiAgY3R4LnN0YXR1cyA9IDIwMDsKfTsKCmV4cG9ydCBkZWZhdWx0IHsKICBjcmVhdGUsCiAgZGVsZXRlb25lLAogIHVwZGF0ZQp9Ow=="},{"version":3,"sources":["/Users/kiyoungtack/Desktop/boiler/src/controllers/commentController.ts"],"names":["db","create","ctx","text","post","postmodel","target","request","body","author","users","findOne","_id","state","user","expup","findOneAndUpdate","$inc","exp","save","comment","comments","cmtpush","posts","push","err","jobs","markets","recomments","status","update","id","params","up","deleteone","del","findOneAndDelete"],"mappings":"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","sourcesContent":["import db from 'db';\nimport { Controller } from './types';\n\nconst create: Controller = async (ctx) => {\n  const { text, post, postmodel, target } = ctx.request.body;\n  const author: any = await db.users.findOne({ _id: ctx.state.user._id });\n  const expup = await db.users.findOneAndUpdate(\n    { _id: author._id },\n    { $inc: { exp: +1 } }\n  );\n  expup?.save();\n  const comment = await db.comments.create({\n    text,\n    author: author,\n    post,\n    postmodel,\n    target,\n  });\n  try {\n    const cmtpush = await db.posts.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.jobs.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.markets.findOne({ _id: post });\n    await (cmtpush as any).comments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n  try {\n    const cmtpush = await db.comments.findOne({ _id: post });\n    await (cmtpush as any).recomments.push(comment._id);\n    cmtpush?.save();\n  } catch (err) {}\n\n  ctx.status = 200;\n};\n\nconst update: Controller = async (ctx) => {\n  const id = ctx.params.id;\n  const { text } = ctx.request.body;\n  const up = await db.comments.findOneAndUpdate(\n    { _id: id },\n    {\n      text,\n    }\n  );\n  ctx.status = 200;\n};\n\nconst deleteone: Controller = async (ctx) => {\n  const id = ctx.params.id;\n  const del = await db.comments.findOneAndDelete({\n    _id: id,\n  });\n  ctx.status = 200;\n};\n\nexport default { create, deleteone, update };\n"]}]}